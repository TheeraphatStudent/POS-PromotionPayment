<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kumto Takoyaki</title>

    <style>
        #result {
            color: #000000;
        }

        #result.cheese {
            color: #527853;
        }

        h1#soldMessage:empty:not(:focus):before {
            content: attr(sellMessage);
            color: rgb(49, 49, 49);
        }
    </style>
</head>

<body>

    <center>
        <h1>Kumto Promotion</h1>
        <h2 id="currentDate"></h2>

        <!-- Option -->
        <button type="button" onclick="order.selectOption('small')"">5</button>
        <button type="button" onclick="order.selectOption('normal')">8</button>
        <button type="button" onclick="order.selectOption('medium')">13</button>
        <button type="button" onclick="order.selectOption('large')">22</button>

        <button type="button" onclick="order.toggleCheese(true)">Cheese</button>
        <button type="button" onclick="order.toggleCheese(false)">No Cheese</button>

        <span style="
            display: flex;
            align-items: center;
            justify-content: center;
        ">
            <h2>
                <p id="result"></p>
            </h2>
            <!-- display in 1 line -->
            <h3>x</h3>
            <h2 id="count">1</h2>
            <h3>=</h3>
            <h2 id="totalCount">0</h2>
            <button type="button" onclick="order.incrementCount()">+</button>
            <button type="button" onclick="order.decrementCount()">-</button>
        </span>

        <button type="button" onclick="order.saveResult()">Save</button>
        <button type="button" onclick="order.clearResult()">Clear</button>
        <button type="button" onclick="order.clearHistory()">Clear History</button>
    </center>

    <h1 id="soldMessage" sellMessage="Product has been sold!"></h1>

    <!-- Use span for display in 1 line -->
    <h3>Total: <span id="total">0</span></h3>

    <p id="history"></p>

    <script>
        window.onload = function currentDate() {
            var date = new Date();

            var datetime = date.getDate() + "/"
                + (date.getMonth() + 1) + "/"
                + date.getFullYear() + " | "
                + date.getHours() + ":"
                + date.getMinutes() + ":"
                + date.getSeconds();

            var displayDate = document.getElementById("currentDate");

            displayDate.innerHTML = datetime
            setTimeout(currentDate, 1000)
        }

        class KumtoOrder {
            constructor() {
                this.result = 0;
                this.isCheese = false;
                this.option = '';
                this.count = 1;
                this.total = 0;
                this.totalCount = 0;
                this.history = [];
                this.updateDisplay();
            }

            updateDisplay() {
                const display = document.getElementById("result");
                const totalCount = document.getElementById("totalCount");
                const countDisplay = document.getElementById("count");

                if (this.isCheese) {
                    display.classList.add("cheese");
                } else {
                    display.classList.remove("cheese");
                }

                totalCount.innerHTML = this.result * this.count;
                display.innerHTML = this.result;
                countDisplay.innerHTML = this.count;
                // this.isCheese = false;
            }

            selectOption(option) {
                this.option = option;
                this.calculatePrice();
                this.updateDisplay();
            }

            toggleCheese(hasCheese) {
                this.isCheese = hasCheese;
                this.calculatePrice();
                this.updateDisplay();
            }

            calculatePrice() {
                const basePrices = {
                    'small': 30,
                    'normal': 40,
                    'medium': 60,
                    'large': 100
                };

                const sizePrice = basePrices[this.option];
                // this.count = 1

                this.result = this.isCheese ? sizePrice + this.getSizeAdjustment() : sizePrice;
            }

            getSizeAdjustment() {
                const sizeAdjustments = {
                    'small': 5,
                    'normal': 10,
                    'medium': 15,
                    'large': 20
                };

                return sizeAdjustments[this.option] || 0;
            }

            incrementCount() {
                this.count++;
                this.updateDisplay();
            }

            decrementCount() {
                if (this.count > 0) {
                    this.count--;
                    this.updateDisplay();
                }
            }

            saveResult() {
                if (this.result === 0) {
                    alert("Please select an option before saving.");
                    return;
                }

                const date = new Date();
                const orderDetails = {
                    promotion: this.option,
                    count: this.count,
                    price: this.result,
                    dateTime: date.toLocaleString()
                };

                this.history.push(orderDetails);
                this.totalCount = this.result * this.count;
                this.total += this.totalCount;
                document.getElementById("total").innerText = this.total;
                document.getElementById("soldMessage").innerText = `${this.option} has been sold!`;
                this.updateHistory();
                this.clearResult();
                this.count = 1;
                this.isCheese = false;
                this.updateDisplay();
            }

            getCount() {
                const countMap = {
                    'small': 5,
                    'normal': 8,
                    'medium': 13,
                    'large': 22
                };
                return countMap[this.option] || 0;
            }

            updateHistory() {
                const historyDisplay = document.getElementById("history");
                historyDisplay.innerHTML = '';

                this.history.forEach((order, index) => {
                    const historyItem = document.createElement("div");
                    historyItem.innerHTML = `${index + 1}. ${order.promotion} - Count: ${order.count} - Price: ${order.price} - Total: ${order.price * order.count} - Date: ${order.dateTime}`;
                    const deleteButton = document.createElement("button");
                    deleteButton.innerText = "Delete";
                    deleteButton.style.marginLeft = "5px";
                    deleteButton.onclick = () => this.deleteHistoryItem(index);
                    historyItem.appendChild(deleteButton);
                    historyDisplay.appendChild(historyItem);
                });
            }

            deleteHistoryItem(index) {
                this.total -= this.history[index].price * this.history[index].count;
                document.getElementById("total").innerText = this.total;
                this.history.splice(index, 1);
                this.updateHistory();
            }

            clearResult() {
                this.result = 0;
                this.count = 1;
                this.updateDisplay();
            }

            clearHistory() {
                this.total = 0;
                this.history = [];
                document.getElementById("total").innerText = this.total;
                this.updateHistory();
            }
        }

        const order = new KumtoOrder();
    </script>

</body>

</html>